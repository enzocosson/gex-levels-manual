//@version=6
indicator("GEX Professional Levels", overlay=true, max_lines_count=500, max_labels_count=500)



// ==================== CSV DATA (AUTO-GENERATED) ====================
string es_csv_zero = "strike,importance,type,label,dte,description\n6902.05,10,zero_gamma,Zero Gamma,0DTE,Vol trigger - Negative Gamma\n6900.0,10,major_put_wall,Major Put Wall,0DTE,Primary put support - 64016 GEX\n6910.0,10,major_call_wall,Major Call Wall,0DTE,Primary call resistance - 152015 GEX\n6905.0,9,high_vol_level,HVL #2,0DTE,High vol zone - 100594 GEX @ 0.0%\n6915.0,9,high_vol_level,HVL #3,0DTE,High vol zone - 84424 GEX @ 0.1%\n6895.0,9,put_wall_0dte,Put Wall 0DTE #2,0DTE,0DTE put support - 50108 GEX\n6899.74,9,put_wall_volume,Put Wall (Vol),0DTE,Put wall from volume data\n6890.0,8,put_wall_secondary,Put Wall #3,0DTE,Secondary put support - 36710 GEX\n6885.0,8,put_wall_secondary,Put Wall #4,0DTE,Secondary put support - 20535 GEX\n6920.0,8,call_wall_secondary,Call Wall #4,0DTE,Secondary call resistance - 57582 GEX\n7140.0,8,max_pain,Max Pain,0DTE,Expiration target - min GEX\n6925.0,7,strike_call,Call Strike,0DTE,Call strike - 20537 GEX\n6880.0,7,strike_put,Put Strike,0DTE,Put strike - 14280 GEX\n6930.0,7,strike_call,Call Strike,0DTE,Call strike - 11903 GEX\n6935.0,7,strike_call,Call Strike,0DTE,Call strike - 6896 GEX\n6875.0,7,strike_put,Put Strike,0DTE,Put strike - 6394 GEX\n6870.0,7,strike_put,Put Strike,0DTE,Put strike - 2946 GEX\n6940.0,7,strike_call,Call Strike,0DTE,Call strike - 2639 GEX\n"
string es_csv_one = "strike,importance,type,label,dte,description\n6899.74,10,zero_gamma,Zero Gamma,0DTE,Vol trigger - Negative Gamma\n6890.0,10,major_put_wall,Major Put Wall,0DTE,Primary put support - 1744 GEX\n6925.0,10,major_call_wall,Major Call Wall,0DTE,Primary call resistance - 3991 GEX\n6930.0,9,high_vol_level,HVL #2,0DTE,High vol zone - 2514 GEX @ 0.3%\n6950.0,9,high_vol_level,HVL #3,0DTE,High vol zone - 2506 GEX @ 0.6%\n6870.0,9,put_wall_0dte,Put Wall 0DTE #2,0DTE,0DTE put support - 1366 GEX\n6910.0,8,call_wall_secondary,Call Wall #4,0DTE,Secondary call resistance - 2246 GEX\n6880.0,8,put_wall_secondary,Put Wall #4,0DTE,Secondary put support - 1052 GEX\n6900.0,8,put_wall_oi,Put Wall (OI),0DTE,Put wall from open interest\n7130.0,8,max_pain,Max Pain,0DTE,Expiration target - min GEX\n6945.0,7,strike_call,Call Strike,0DTE,Call strike - 2011 GEX\n6920.0,7,strike_call,Call Strike,0DTE,Call strike - 1884 GEX\n6935.0,7,strike_call,Call Strike,0DTE,Call strike - 1478 GEX\n6915.0,7,strike_call,Call Strike,0DTE,Call strike - 1336 GEX\n6955.0,7,strike_call,Call Strike,0DTE,Call strike - 1237 GEX\n6940.0,7,strike_call,Call Strike,0DTE,Call strike - 1210 GEX\n6960.0,7,strike_call,Call Strike,0DTE,Call strike - 1110 GEX\n"
string es_csv_full = "strike,importance,type,label,dte,description\n6901.61,10,zero_gamma,Zero Gamma,0DTE,Vol trigger - Negative Gamma\n6910.0,10,major_call_wall,Major Call Wall,0DTE,Primary call resistance - 158647 GEX\n6900.0,10,major_put_wall,Major Put Wall,0DTE,Primary put support - 58519 GEX\n6905.0,9,high_vol_level,HVL #2,0DTE,High vol zone - 110960 GEX @ 0.0%\n6915.0,9,high_vol_level,HVL #3,0DTE,High vol zone - 87847 GEX @ 0.1%\n6895.0,9,put_wall_0dte,Put Wall 0DTE #2,0DTE,0DTE put support - 51042 GEX\n6899.74,9,put_wall_volume,Put Wall (Vol),0DTE,Put wall from volume data\n6885.0,8,put_wall_secondary,Put Wall #4,0DTE,Secondary put support - 20054 GEX\n6890.0,8,put_wall_secondary,Put Wall #3,0DTE,Secondary put support - 37752 GEX\n6920.0,8,call_wall_secondary,Call Wall #4,0DTE,Secondary call resistance - 62721 GEX\n7000.0,8,call_wall_oi,Call Wall (OI),0DTE,Call wall from open interest\n7145.0,8,max_pain,Max Pain,0DTE,Expiration target - min GEX\n6925.0,7,strike_call,Call Strike,0DTE,Call strike - 30514 GEX\n6930.0,7,strike_call,Call Strike,0DTE,Call strike - 16712 GEX\n6880.0,7,strike_put,Put Strike,0DTE,Put strike - 15950 GEX\n6950.0,7,strike_call,Call Strike,0DTE,Call strike - 12833 GEX\n6935.0,7,strike_call,Call Strike,0DTE,Call strike - 9411 GEX\n6875.0,7,strike_put,Put Strike,0DTE,Put strike - 9045 GEX\n"
string nq_csv_zero = "strike,importance,type,label,dte,description\n25471.66,10,zero_gamma,Zero Gamma,0DTE,Vol trigger - Negative Gamma\n25450.0,10,major_put_wall,Major Put Wall,0DTE,Primary put support - 2605 GEX\n25530.0,10,major_call_wall,Major Call Wall,0DTE,Primary call resistance - 4089 GEX\n25550.0,9,high_vol_level,HVL #2,0DTE,High vol zone - 3723 GEX @ 0.1%\n25540.0,9,high_vol_level,HVL #3,0DTE,High vol zone - 3099 GEX @ 0.1%\n25500.0,9,put_wall_0dte,Put Wall 0DTE #2,0DTE,0DTE put support - 1648 GEX\n25560.0,8,call_wall_secondary,Call Wall #4,0DTE,Secondary call resistance - 2655 GEX\n25410.0,8,put_wall_secondary,Put Wall #3,0DTE,Secondary put support - 948 GEX\n25400.0,8,put_wall_secondary,Put Wall #4,0DTE,Secondary put support - 852 GEX\n25510.0,8,put_wall_oi,Put Wall (OI),0DTE,Put wall from open interest\n25560.16,8,call_wall_oi,Call Wall (OI),0DTE,Call wall from open interest\n26020.0,8,max_pain,Max Pain,0DTE,Expiration target - min GEX\n25600.0,7,strike_call,Call Strike,0DTE,Call strike - 2224 GEX\n25570.0,7,strike_call,Call Strike,0DTE,Call strike - 2108 GEX\n25610.0,7,strike_call,Call Strike,0DTE,Call strike - 1283 GEX\n25580.0,7,strike_call,Call Strike,0DTE,Call strike - 1116 GEX\n25430.0,7,strike_put,Put Strike,0DTE,Put strike - 829 GEX\n25420.0,7,strike_put,Put Strike,0DTE,Put strike - 723 GEX\n25590.0,7,strike_call,Call Strike,0DTE,Call strike - 698 GEX\n25480.0,7,vol_trigger,Vol Trigger (10min),0DTE,Vol trigger - GEX Œî +974 (10min)\n"
string nq_csv_one = "strike,importance,type,label,dte,description\n25484.1,10,zero_gamma,Zero Gamma,0DTE,Vol trigger - Negative Gamma\n25500.0,10,major_call_wall,Major Call Wall,0DTE,Primary call resistance - 184 GEX\n25450.0,10,major_put_wall,Major Put Wall,0DTE,Primary put support - 78 GEX\n25400.0,9,put_wall_0dte,Put Wall 0DTE #2,0DTE,0DTE put support - 62 GEX\n25600.0,9,call_wall_0dte,Call Wall 0DTE #1,0DTE,0DTE call resistance - 142 GEX\n25800.0,8,call_wall_oi,Call Wall (OI),0DTE,Call wall from open interest\n25590.0,8,put_wall_oi,Put Wall (OI),0DTE,Put wall from open interest\n25490.0,8,call_wall_secondary,Call Wall #3,0DTE,Secondary call resistance - 87 GEX\n25650.0,8,call_wall_secondary,Call Wall #4,0DTE,Secondary call resistance - 69 GEX\n25480.0,8,put_wall_secondary,Put Wall #3,0DTE,Secondary put support - 59 GEX\n25380.0,8,put_wall_secondary,Put Wall #4,0DTE,Secondary put support - 47 GEX\n25020.0,8,max_pain,Max Pain,0DTE,Expiration target - min GEX\n"
string nq_csv_full = "strike,importance,type,label,dte,description\n25475.08,10,zero_gamma,Zero Gamma,0DTE,Vol trigger - Negative Gamma\n25450.0,10,major_put_wall,Major Put Wall,0DTE,Primary put support - 2702 GEX\n25530.0,10,major_call_wall,Major Call Wall,0DTE,Primary call resistance - 4078 GEX\n25550.0,9,high_vol_level,HVL #2,0DTE,High vol zone - 3744 GEX @ 0.1%\n25540.0,9,high_vol_level,HVL #3,0DTE,High vol zone - 3097 GEX @ 0.1%\n25410.0,9,put_wall_0dte,Put Wall 0DTE #2,0DTE,0DTE put support - 992 GEX\n25560.0,8,call_wall_secondary,Call Wall #4,0DTE,Secondary call resistance - 2692 GEX\n25400.0,8,put_wall_secondary,Put Wall #3,0DTE,Secondary put support - 927 GEX\n25430.0,8,put_wall_secondary,Put Wall #4,0DTE,Secondary put support - 858 GEX\n25510.16,8,put_wall_oi,Put Wall (OI),0DTE,Put wall from open interest\n25250.0,8,call_wall_oi,Call Wall (OI),0DTE,Call wall from open interest\n25225.0,8,max_pain,Max Pain,0DTE,Expiration target - min GEX\n25600.0,7,strike_call,Call Strike,0DTE,Call strike - 2586 GEX\n25570.0,7,strike_call,Call Strike,0DTE,Call strike - 2169 GEX\n25610.0,7,strike_call,Call Strike,0DTE,Call strike - 1343 GEX\n25580.0,7,strike_call,Call Strike,0DTE,Call strike - 1131 GEX\n25420.0,7,strike_put,Put Strike,0DTE,Put strike - 756 GEX\n25590.0,7,strike_call,Call Strike,0DTE,Call strike - 722 GEX\n25500.0,7,vol_trigger,Vol Trigger (1min),0DTE,Vol trigger - GEX Œî -351 (1min)\n25510.0,7,vol_trigger,Vol Trigger (5min),0DTE,Vol trigger - GEX Œî +592 (5min)\n25480.0,7,vol_trigger,Vol Trigger (10min),0DTE,Vol trigger - GEX Œî +974 (10min)\n"



// ==================== METADATA ====================
string es_meta_zero = "Timestamp:1767037283|Symbol:SPX|Spot:6906.50|FrontDTE:0|NextDTE:1|VolTrigger:6902.05|NetGEXVol:247304.79|NetGEXOI:-6397.16|CallResAll:341073.10|PutSupAll:200757.19"
string es_meta_one = "Timestamp:1767037286|Symbol:SPX|Spot:6906.77|FrontDTE:0|NextDTE:1|VolTrigger:6899.74|NetGEXVol:8619.78|NetGEXOI:3317.80|CallResAll:23558.81|PutSupAll:12114.28"
string es_meta_full = "Timestamp:1767037286|Symbol:SPX|Spot:6906.77|FrontDTE:0|NextDTE:1|VolTrigger:6901.61|NetGEXVol:282554.78|NetGEXOI:42392.63|CallResAll:440973.42|PutSupAll:226986.34"
string nq_meta_zero = "Timestamp:1767037286|Symbol:NDX|Spot:25515.83|FrontDTE:0|NextDTE:1|VolTrigger:25471.66|NetGEXVol:12174.58|NetGEXOI:-974.35|CallResAll:23882.12|PutSupAll:13250.91"
string nq_meta_one = "Timestamp:1767037287|Symbol:NDX|Spot:25515.68|FrontDTE:0|NextDTE:1|VolTrigger:25484.10|NetGEXVol:248.90|NetGEXOI:85.60|CallResAll:897.70|PutSupAll:859.08"
string nq_meta_full = "Timestamp:1767037287|Symbol:NDX|Spot:25515.68|FrontDTE:0|NextDTE:1|VolTrigger:25475.08|NetGEXVol:13152.14|NetGEXOI:1758.88|CallResAll:26388.41|PutSupAll:13044.19"



// ==================== AUTO-DETECTION TICKER ====================
string detected_ticker = "ES"
if str.contains(syminfo.ticker, "NQ") or str.contains(syminfo.ticker, "NDX") or str.contains(syminfo.ticker, "NAS")
    detected_ticker := "NQ"
else if str.contains(syminfo.ticker, "ES") or str.contains(syminfo.ticker, "SPX") or str.contains(syminfo.ticker, "SP500")
    detected_ticker := "ES"



// ==================== MULTIPLICATEURS FIXES ====================
float SPX_MULTIPLIER = 1.00685
float NDX_MULTIPLIER = 1.00842



float conversion_multiplier = 1.0
bool needs_conversion = false



if detected_ticker == "ES"
    if str.contains(syminfo.ticker, "ES") and not str.contains(syminfo.ticker, "SPX")
        conversion_multiplier := SPX_MULTIPLIER
        needs_conversion := true
else if detected_ticker == "NQ"
    if str.contains(syminfo.ticker, "NQ") and not str.contains(syminfo.ticker, "NDX")
        conversion_multiplier := NDX_MULTIPLIER
        needs_conversion := true



// ==================== PARAM√àTRES ====================
string selected_dte = input.string("0DTE", "üìÖ DTE Period", options=["0DTE", "1DTE", "FULL"], group="üéØ Settings", tooltip="Days To Expiration")



// ==================== FILTRES PAR IMPORTANCE ====================
bool show_imp_10 = input.bool(true, "Importance 10 (Major Walls/Volatility Trigger)", group="üéØ Importance Filters")
bool show_imp_9 = input.bool(true, "Importance 9 (High Vol Levels, 0DTE Walls)", group="üéØ Importance Filters")
bool show_imp_8 = input.bool(true, "Importance 8 (Secondary Walls, Max Pain)", group="üéØ Importance Filters")
bool show_imp_7 = input.bool(false, "Importance 7 (Individual Strikes, Vol Triggers)", group="üéØ Importance Filters")



// ==================== FILTRES PAR TYPE ====================
bool show_volatility_trigger = input.bool(true, "Volatility Trigger", group="üìå Level Types", tooltip="Zero gamma flip point")
bool show_major_walls = input.bool(true, "Major Call/Put Walls", group="üìå Level Types", tooltip="Primary resistance and support")
bool show_high_vol_levels = input.bool(true, "High Vol Levels (HVL)", group="üìå Level Types", tooltip="High volatility zones near spot")
bool show_0dte_walls = input.bool(true, "0DTE Call/Put Walls", group="üìå Level Types", tooltip="Same-day expiry walls")
bool show_secondary_walls = input.bool(true, "Secondary Walls", group="üìå Level Types", tooltip="Call resistance and put support #2-4")
bool show_max_pain = input.bool(true, "Max Pain Level", group="üìå Level Types", tooltip="Expiration target strike")
bool show_individual_strikes = input.bool(false, "Individual Strikes", group="üìå Level Types", tooltip="Top 15 strikes by GEX")
bool show_vol_triggers = input.bool(false, "Vol Triggers (Timeframe)", group="üìå Level Types", tooltip="GEX change triggers by interval")



// ==================== STYLE ====================
color color_volatility_trigger = input.color(color.new(color.purple, 0), "Volatility Trigger", group="üé® Colors", inline="c1")
color color_major_call_wall = input.color(color.new(color.red, 0), "Major Call Wall", group="üé® Colors", inline="c2")
color color_major_put_wall = input.color(color.new(color.green, 0), "Major Put Wall", group="üé® Colors", inline="c3")
color color_high_vol_level = input.color(color.new(color.orange, 0), "High Vol Level", group="üé® Colors", inline="c4")
color color_0dte_walls = input.color(color.new(color.yellow, 0), "0DTE Walls", group="üé® Colors", inline="c5")
color color_secondary_walls = input.color(color.new(color.gray, 30), "Secondary Walls", group="üé® Colors", inline="c6")
color color_max_pain = input.color(color.new(color.blue, 0), "Max Pain", group="üé® Colors", inline="c7")
color color_strikes = input.color(color.new(color.silver, 50), "Individual Strikes", group="üé® Colors", inline="c8")
color color_vol_trigger = input.color(color.new(color.fuchsia, 0), "Vol Triggers", group="üé® Colors", inline="c9")



// ==================== LABEL SETTINGS ====================
bool show_labels = input.bool(true, "Show Labels", group="üè∑Ô∏è Labels", tooltip="Display level labels on chart")
bool show_descriptions = input.bool(false, "Show Descriptions", group="üè∑Ô∏è Labels", tooltip="Add detailed descriptions to labels")
string label_size = input.string("Small", "Label Size", options=["Tiny", "Small", "Normal", "Large"], group="üè∑Ô∏è Labels")
bool use_distance_filter = input.bool(false, "Filter Labels Near Price", group="üè∑Ô∏è Labels", tooltip="Hide labels too close to current price")
float label_min_distance_pct = input.float(0.3, "Min Distance from Price (%)", minval=0, maxval=5, step=0.1, group="üè∑Ô∏è Labels")



// ==================== METADATA DISPLAY ====================
bool show_metadata = input.bool(false, "Show Market Info Table", group="üìä Metadata", tooltip="Display GEX metadata table (separate from chart)")



// ==================== DEFINITIONS TABLE ====================
bool show_definitions = input.bool(false, "Afficher les D√©finitions", group="üìñ Aide", tooltip="Tableau des d√©finitions des termes GEX")



// ==================== STOCKAGE ====================
var array<line> all_lines = array.new<line>()
var array<label> all_labels = array.new<label>()



// ==================== FONCTIONS ====================
get_label_size(string size) =>
    size == "Tiny" ? size.tiny : size == "Small" ? size.small : size == "Normal" ? size.normal : size.large



should_show_level(int importance, string level_type) =>
    bool show_importance = (importance == 10 and show_imp_10) or (importance == 9 and show_imp_9) or (importance == 8 and show_imp_8) or (importance == 7 and show_imp_7)
    
    bool show_type = false
    if str.contains(level_type, "volatility_trigger")
        show_type := show_volatility_trigger
    else if str.contains(level_type, "major_call_wall") or str.contains(level_type, "major_put_wall")
        show_type := show_major_walls
    else if str.contains(level_type, "high_vol_level")
        show_type := show_high_vol_levels
    else if str.contains(level_type, "0dte")
        show_type := show_0dte_walls
    else if str.contains(level_type, "call_resistance") or str.contains(level_type, "put_support") or str.contains(level_type, "call_wall") or str.contains(level_type, "put_wall")
        show_type := show_secondary_walls
    else if str.contains(level_type, "max_pain")
        show_type := show_max_pain
    else if str.contains(level_type, "strike_")
        show_type := show_individual_strikes
    else if str.contains(level_type, "vol_trigger")
        show_type := show_vol_triggers
    
    show_importance and show_type



get_level_color(string level_type) =>
    color result = color_strikes
    if str.contains(level_type, "volatility_trigger")
        result := color_volatility_trigger
    else if str.contains(level_type, "major_call_wall")
        result := color_major_call_wall
    else if str.contains(level_type, "major_put_wall")
        result := color_major_put_wall
    else if str.contains(level_type, "high_vol_level")
        result := color_high_vol_level
    else if str.contains(level_type, "0dte")
        result := color_0dte_walls
    else if str.contains(level_type, "call_resistance") or str.contains(level_type, "put_support") or str.contains(level_type, "call_wall") or str.contains(level_type, "put_wall")
        result := color_secondary_walls
    else if str.contains(level_type, "max_pain")
        result := color_max_pain
    else if str.contains(level_type, "vol_trigger")
        result := color_vol_trigger
    result



clear_all_objects() =>
    if array.size(all_lines) > 0
        for i = 0 to array.size(all_lines) - 1
            line.delete(array.get(all_lines, i))
        array.clear(all_lines)
    if array.size(all_labels) > 0
        for i = 0 to array.size(all_labels) - 1
            label.delete(array.get(all_labels, i))
        array.clear(all_labels)



process_csv(string csv_data) =>
    if bar_index == last_bar_index
        lines_array = str.split(csv_data, "\n")
        int total_lines = array.size(lines_array)
        for i = 1 to total_lines - 1
            if i < total_lines
                string line_str = array.get(lines_array, i)
                line_str := str.replace_all(line_str, "\r", "")
                if str.length(line_str) > 10 and not str.contains(line_str, "strike,importance")
                    fields = str.split(line_str, ",")
                    int num_fields = array.size(fields)
                    if num_fields >= 6
                        string field0 = array.get(fields, 0)
                        string field1 = array.get(fields, 1)
                        if str.length(field0) > 0 and str.length(field1) > 0
                            float strike_price_raw = str.tonumber(field0)
                            int importance = int(str.tonumber(field1))
                            if not na(strike_price_raw) and not na(importance) and importance >= 7 and importance <= 10
                                float strike_price = needs_conversion ? strike_price_raw * conversion_multiplier : strike_price_raw
                                
                                string level_type = array.get(fields, 2)
                                string label_text = array.get(fields, 3)
                                string description = num_fields >= 6 ? array.get(fields, 5) : ""
                                
                                if should_show_level(importance, level_type)
                                    color level_color = get_level_color(level_type)
                                    line new_line = line.new(x1=bar_index[500], y1=strike_price, x2=bar_index, y2=strike_price, color=level_color, width=1, style=line.style_solid, extend=extend.right)
                                    array.push(all_lines, new_line)
                                    
                                    if show_labels
                                        bool show_this_label = true
                                        if use_distance_filter
                                            float price_distance = math.abs(close - strike_price)
                                            float min_distance = close * (label_min_distance_pct / 100)
                                            show_this_label := price_distance > min_distance
                                        
                                        if show_this_label
                                            string final_label = label_text + " " + str.tostring(strike_price, "#.##")
                                            if show_descriptions and str.length(description) > 0
                                                final_label := final_label + "\n" + description
                                            
                                            label new_label = label.new(x=bar_index, y=strike_price, text=final_label, color=color.new(color.white, 100), textcolor=level_color, style=label.style_none, size=get_label_size(label_size))
                                            array.push(all_labels, new_label)



// ==================== EX√âCUTION ====================
if barstate.islast
    clear_all_objects()
    
    string csv_active = ""
    string meta_active = ""
    
    if detected_ticker == "ES"
        csv_active := selected_dte == "0DTE" ? es_csv_zero : selected_dte == "1DTE" ? es_csv_one : es_csv_full
        meta_active := selected_dte == "0DTE" ? es_meta_zero : selected_dte == "1DTE" ? es_meta_one : es_meta_full
    else
        csv_active := selected_dte == "0DTE" ? nq_csv_zero : selected_dte == "1DTE" ? nq_csv_one : nq_csv_full
        meta_active := selected_dte == "0DTE" ? nq_meta_zero : selected_dte == "1DTE" ? nq_meta_one : nq_meta_full
    
    process_csv(csv_active)
    
    // Afficher la table de m√©tadonn√©es
    if show_metadata and str.length(meta_active) > 0
        var table meta_tbl = table.new(position.top_right, 2, 11, bgcolor=color.new(color.gray, 85), border_width=1, border_color=color.new(color.white, 50))
        
        table.clear(meta_tbl, 0, 0, 1, 10)
        
        parts = str.split(meta_active, "|")
        table.cell(meta_tbl, 0, 0, "GEX Metadata", text_color=color.white, text_size=size.small, bgcolor=color.new(color.blue, 70))
        table.cell(meta_tbl, 1, 0, "", text_color=color.white, text_size=size.small, bgcolor=color.new(color.blue, 70))
        
        int row = 1
        for part in parts
            kv = str.split(part, ":")
            if array.size(kv) == 2
                key = array.get(kv, 0)
                val = array.get(kv, 1)
                table.cell(meta_tbl, 0, row, key, text_color=color.white, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
                table.cell(meta_tbl, 1, row, val, text_color=color.yellow, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
                row := row + 1
    
    // Afficher le tableau des d√©finitions
    if show_definitions
        var table def_tbl = table.new(position.bottom_left, 2, 11, bgcolor=color.new(color.gray, 85), border_width=1, border_color=color.new(color.white, 50))
        
        table.clear(def_tbl, 0, 0, 1, 10)
        
        // En-t√™te
        table.cell(def_tbl, 0, 0, "üìñ TERMES GEX", text_color=color.white, text_size=size.small, bgcolor=color.new(color.purple, 70))
        table.cell(def_tbl, 1, 0, "D√âFINITION", text_color=color.white, text_size=size.small, bgcolor=color.new(color.purple, 70))
        
        // GEX
        table.cell(def_tbl, 0, 1, "GEX", text_color=color.white, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 1, "Gamma Exposure - Volume de couverture n√©cessaire aux market makers pour un mouvement de 1%", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        
        // Zero Gamma / Volatility Trigger
        table.cell(def_tbl, 0, 2, "Zero Gamma", text_color=color.purple, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 2, "Point de bascule o√π le gamma net = 0. Au-dessus: volatilit√© amplifi√©e. En dessous: volatilit√© supprim√©e", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        
        // Major Call Wall
        table.cell(def_tbl, 0, 3, "Major Call Wall", text_color=color.red, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 3, "R√©sistance primaire - Strike call avec le plus fort GEX. Les MM vendent en approchant ce niveau", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        
        // Major Put Wall
        table.cell(def_tbl, 0, 4, "Major Put Wall", text_color=color.green, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 4, "Support primaire - Strike put avec le plus fort GEX. Les MM ach√®tent en approchant ce niveau", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        
        // HVL
        table.cell(def_tbl, 0, 5, "HVL", text_color=color.orange, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 5, "High Vol Level - Zone de fort GEX proche du spot (<1.5%). Intensifie les mouvements de prix", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        
        // 0DTE Walls
        table.cell(def_tbl, 0, 6, "0DTE Walls", text_color=color.yellow, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 6, "Murs d'expiration jour m√™me - Support/r√©sistance actifs uniquement le jour d'expiration", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        
        // Max Pain
        table.cell(def_tbl, 0, 7, "Max Pain", text_color=color.blue, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 7, "Strike o√π le GEX total est minimal - Cible d'expiration th√©orique o√π les options perdent le plus", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        
        // Vol Trigger
        table.cell(def_tbl, 0, 8, "Vol Trigger", text_color=color.fuchsia, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 8, "Strike avec variation GEX significative sur intervalle temporel - Signal de changement de flux", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        
        // DTE
        table.cell(def_tbl, 0, 9, "DTE", text_color=color.white, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 9, "Days To Expiration - Jours avant expiration des options (0DTE = jour m√™me, 1DTE = lendemain)", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        
        // Positive/Negative Gamma
        table.cell(def_tbl, 0, 10, "Gamma Regime", text_color=color.white, text_size=size.tiny, bgcolor=color.new(color.gray, 90))
        table.cell(def_tbl, 1, 10, "Pos: MM stabilisent (ach√®tent bas/vendent haut). Neg: MM amplifient (ach√®tent haut/vendent bas)", text_color=color.silver, text_size=size.tiny, bgcolor=color.new(color.gray, 90))



plot(close, title="Price", display=display.none)
